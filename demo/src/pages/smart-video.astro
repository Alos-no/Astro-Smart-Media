---
import DemoLayout from "../layouts/DemoLayout.astro";
import Tabs from "../components/Tabs.astro";
import DemoBlock from "../components/DemoBlock.astro";
import InspectorTable from "../components/InspectorTable.astro";

import { SmartVideo as SmartVideoDemo } from "@alos-no/astro-media";
import posterImage from "../assets/poster.jpg";

// Public test HLS source (Mux).
const HLS = "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8";
---

<DemoLayout title="Astro Media — SmartVideo">
  <div class="callout">
    <strong>SmartVideo</strong> demonstrates HLS with graceful fallbacks, autoplay-on-intersection, hover-to-play, and standard
    controls. Each panel isolates a behavior to make validation easy. Inspectors update live with the player state.
  </div>

  <Tabs
    tabs={[
      { id: "autoplay", label: "Autoplay in viewport" },
      { id: "hover", label: "Play on hover" },
      { id: "controls", label: "User controls" },
      { id: "fallback", label: "Fallback sources only" },
    ]}
    initialId="autoplay"
  >
    <Fragment slot="panels">
      <!-- Panel: Autoplay in viewport -->
      <section data-tab-panel="autoplay">
        <DemoBlock
          title="Autoplay with IntersectionObserver"
          description="Scroll if needed; playback starts when ≥25% visible and pauses when out of view."
        >
          <!-- Spacer so the video starts below the fold; ensures intersection changes occur. -->
          <div
            style="height: 120vh; display: grid; place-items: center; color: #a7adb7; border: 1px dashed #22252a; margin-bottom: 0.75rem;"
          >
            <small>Scroll down to reach the video</small>
          </div>

          <div class="demo-grid">
            <div id="sv-auto" style="width:100%; margin: 0 auto; aspect-ratio: 16 / 9; border:1px solid #22252a;">
              <SmartVideoDemo
                hlsSrc={HLS}
                src="/videos/fallback"
                poster={posterImage}
                class=""
                autoplay={true}
                loop={true}
                muted={true}
              />
            </div>

            <InspectorTable id="sv-auto-inspector" title="Autoplay — Live inspector" />
          </div>

          <!-- Extra spacer so you can scroll past the video and watch it pause when out of view. -->
          <div style="height: 120vh; border: 1px dashed #22252a; margin-top: 0.75rem;"></div>
        </DemoBlock>
      </section>

      <!-- Panel: Hover -->
      <section data-tab-panel="hover">
        <DemoBlock title="Play on hover" description="Poster returns when paused after mouse leaves.">
          <div class="demo-grid">
            <div id="sv-hover" style="width:100%; margin: 0 auto; aspect-ratio: 16 / 9; border:1px solid #22252a;">
              <SmartVideoDemo
                hlsSrc={HLS}
                src="/videos/fallback"
                poster={posterImage}
                class=""
                playOnHover={true}
                muted={true}
                loop={true}
              />
            </div>

            <InspectorTable id="sv-hover-inspector" title="Hover — Live inspector" />
          </div>
        </DemoBlock>
      </section>

      <!-- Panel: Controls -->
      <section data-tab-panel="controls">
        <DemoBlock title="Standard controls" description="Hand control to users; autoplay disabled.">
          <div class="demo-grid">
            <div id="sv-ctrl" style="width:100%; margin: 0 auto; aspect-ratio: 16 / 9; border:1px solid #22252a;">
              <SmartVideoDemo
                hlsSrc={HLS}
                src="/videos/fallback"
                poster={posterImage}
                class=""
                controls={true}
                autoplay={false}
                muted={false}
              />
            </div>

            <InspectorTable id="sv-ctrl-inspector" title="Controls — Live inspector" />
          </div>
        </DemoBlock>
      </section>

      <!-- Panel: Fallback only -->
      <section data-tab-panel="fallback">
        <DemoBlock
          title="No HLS → MP4/WebM sources"
          description="Demonstrates the source appending and load() path without HLS."
        >
          <div class="demo-grid">
            <div id="sv-fallback" style="width:100%; margin: 0 auto; aspect-ratio: 16 / 9; border:1px solid #22252a;">
              <SmartVideoDemo
                src="/videos/fallback"
                poster={posterImage}
                class=""
                autoplay={false}
                controls={true}
                loop={false}
              />
            </div>

            <InspectorTable id="sv-fallback-inspector" title="Fallback — Live inspector" />
          </div>
        </DemoBlock>
      </section>
    </Fragment>
  </Tabs>
</DemoLayout>

<script type="module">
  import { initVideoInspector } from "/src/utils/inspectors.js";

  // Wire up all inspectors on this page.
  initVideoInspector("sv-auto", "sv-auto-inspector");
  initVideoInspector("sv-hover", "sv-hover-inspector");
  initVideoInspector("sv-ctrl", "sv-ctrl-inspector");
  initVideoInspector("sv-fallback", "sv-fallback-inspector");
</script>
